​                           

 



 

# 摘要

天气预报在日常生活和工作中具有重要意义。它可以帮助人们提前了解即将到来的天气状况，从而做出合理的安排和准备。无论是农民决定何时种植作物、渔民选择最佳的捕鱼时间，还是城市居民规划出行和户外活动，天气预报都起到了关键作用。准确的天气预报还能够帮助防灾减灾，减少因极端天气导致的人员伤亡和财产损失。本项目的安卓天气预报应用程序是为满足用户对实时和准确天气信息的需求而开发的。应用启动时会自动定位用户位置，并从本地存储中读取之前的位置数据。如果自动定位失败，用户可以手动选择位置。应用提供当前温度、天气图标、体感温度、湿度、空气质量、紫外线指数、感冒风险和能见度等详细信息，并展示未来几天的天气预报。

**关键字**：安卓，天气预报程序，API，响应式，精确定位，数据持久化

   Summary

Weather forecast is of great significance in daily life and work. It can help people understand the upcoming weather conditions in advance so as to make reasonable arrangements and preparations. Weather forecast plays a key role whether farmers decide when to plant crops, fishermen choose the best time to fish, or urban residents plan travel and outdoor activities. Accurate weather forecast can also help prevent and reduce disasters, and reduce casualties and property losses caused by extreme weather. The Android weather forecast application in this project is developed to meet users' needs for real-time and accurate weather information. When the application is started, it automatically locates the user's location and reads the previous location data from local storage. If the automatic positioning fails, the user can manually select the location. The application provides detailed information such as current temperature, weather icon, body temperature, humidity, air quality, UV index, cold risk and visibility, and displays the weather forecast for the next few days. 

**Keywords**: Android, weather forecast program, API, responsive, precise positioning, data persistence。

 

# 目录

[摘要... 2](#_Toc170306168)

[目录... 3](#_Toc170306169)

[第一章   概述... 4](#_Toc170306170)

[1.1   项目背景... 4](#_Toc170306171)

[1.2   项目意义... 4](#_Toc170306172)

[1.3 项目目标... 4](#_Toc170306173)

[1.4   内容结构... 4](#_Toc170306174)

[第二章 技术选型与开发环境... 5](#_Toc170306175)

[第三章： 需求分析... 5](#_Toc170306176)

[3.1 用户分析... 5](#_Toc170306177)

[3.2 功能性需求分析... 6](#_Toc170306178)

[3.3 非功能性需求分析... 7](#_Toc170306179)

[第四章 系统设计及实现... 7](#_Toc170306180)

[4.1 运行逻辑分析... 7](#_Toc170306181)

[4.2 核心功能实现... 8](#_Toc170306182)

[4.2.1 定位模块... 8](#_Toc170306183)

[4.2.2 天气模块... 9](#_Toc170306184)

[4.2.3 数据持久化功能... 10](#_Toc170306185)

[第五章 开发日志... 12](#_Toc170306186)

[第六章： 总结与展望... 15](#_Toc170306187)

 



 

# 第一章   概述

## 1.1   项目背景

随着智能手机的普及和移动互联网的快速发展，天气预报应用已经成为人们日常生活中必不可少的一部分。准确及时的天气信息能够帮助用户合理安排日常生活和工作，避免因为天气变化带来的不便和损失。目前市场上虽然已有多款天气预报应用，但仍然存在着界面复杂、广告过多、信息更新不及时等问题。为了解决这些问题，本次课程设计旨在开发一款简洁高效、功能实用的安卓天气预报应用。

## 1.2   项目意义

开发一款新的天气预报应用不仅能提高个人的编程能力和安卓开发技术水平，还能为用户提供更好的使用体验。通过这个项目，能够更好地理解安卓平台的开发流程和应用架构设计，掌握常用的开发工具和技术，同时也为后续的实际开发工作奠定基础。此外，本项目还具有一定的社会意义，能够为用户提供精准的天气预报服务，提升用户的生活质量和效率。

## 1.3 项目目标

本项目的主要目标是开发一款简洁、实用、高效的安卓天气预报应用。具体目标为：

² 实现实时天气信息的获取和展示。

² 提供未来几天天气预报功能。

² 支持多城市天气查询。

² 界面设计简洁美观，用户体验良好。

² 确保应用运行稳定，响应迅速。

## 1.4      内容结构

本报告共分为六个章节，具体内容如下：

第一章 概述：介绍项目背景、意义、目标及报告的整体结构。

第二章 技术选型与开发环境：详细说明本项目所采用的技术方案和开发工具，包括编程语言、开发平台、API接口等。

第三章 需求分析：分析用户需求，明确应用需要实现的功能。

第四章 系统设计及实现：描述系统的总体设计和各模块的实现过程。

第五章 开发日志：记录应用开发的具体过程。

第六章 总结与展望

# 第二章 技术选型与开发环境

开发环境：Android Studio

定位SDK: 高德定位SDK

天气API: 彩云天气API

JSON解析库：Google Gson

Http请求库：Apache Commons IO

代码托管平台：GitHub

# 第三章： 需求分析

## 3.1 用户分析

安卓天气预报应用的主要用户群体包括普通用户、户外活动爱好者和特定职业人员。普通用户年龄范围广泛，从18岁到60岁不等，性别不限，涵盖学生、上班族、自由职业者等。他们使用天气应用的主要目的是获取日常生活所需的天气信息，以便安排出行、穿衣等日常活动。这类用户通常居住在城市或乡村，也包括一些经常旅行的人群。他们的技术水平一般，对应用的使用要求是简单、直观、准确。

户外活动爱好者是另一个重要用户群体。他们包括跑步者、骑行者、徒步旅行者、露营者等。这类用户对天气信息的需求更加详细和及时，尤其关注实时天气变化、降雨预报、风速和温度等数据，以便安全地安排户外活动。他们希望应用能够提供精准的小时预报和天气预警，并且需要在离线状态下也能获取到部分天气信息。

特定职业人员如农民、渔民、建筑工人、交警等对天气信息的依赖程度更高。这些职业对天气的要求直接关系到工作安排和安全保障，例如农民需要了解未来几天的降雨情况以决定耕作时间，渔民需要了解风浪信息以保证出海安全，建筑工人需要天气预报来安排工期，交警需要提前知晓恶劣天气预警以便采取交通管理措施。他们需要应用提供精确、及时的天气预警功能，并能够针对特定天气情况给出建议。

总的来说，所有用户对天气预报应用的核心需求是准确、及时和易用。为了满足这些需求，应用需要具备实时天气更新、未来几天的天气预报、天气预警和通知功能，并且界面简洁、操作方便。同时，考虑到用户可能会有个性化需求，应用应该提供多种自定义选项，例如不同的温度单位、语言选择、主题模式等。为了提升用户体验，应用还可以加入桌面小部件、天气图表和动画效果等功能，帮助用户更直观地获取天气信息。通过这些分析，可以为不同类型的用户提供量身定制的天气服务，提升用户满意度和应用的使用频率。

## 3.2 功能性需求分析

我们需要综合考虑用户对天气预报应用的核心需求，确保应用能够满足他们的日常使用场景。首先，应用需要一个直观的主页，展示当前地点的实时天气信息，包括温度、天气状况、湿度和风速等。这些信息应以简洁明了的方式呈现，方便用户快速获取所需数据。为了提供更全面的天气信息，应用还应包含未来3天的天气预报，用户可以通过简单的滑动或点击查看详细的逐日预报和未来24小时的小时预报，这对于规划未来的活动尤为重要。

应用必须具备地点搜索和管理功能，允许用户添加多个地点的天气预报。这对经常旅行或需要关注多个城市天气的用户非常有用。用户可以通过搜索栏输入地点名称，快速获取所需的天气信息。此外，应用应支持自动定位功能，用户打开应用时即可自动获取当前所在位置的天气情况，方便快捷。

天气预警功能也是必不可少的，应用应及时接收并展示各种天气预警信息，如暴雨、台风、高温等。这些预警信息应该以通知的形式推送给用户，并在应用内显著位置显示，以确保用户能够及时采取相应措施。此外，应用应允许用户设置每日固定时间的天气提醒，通过通知方式提醒用户当天的天气状况，帮助用户更好地安排一天的活动。

为了提升用户体验，应用应提供多种数据可视化方式，包括温度、降水概率和风速等数据的图表展示，帮助用户更直观地理解天气变化。

## 3.3 非功能性需求分析

主要关注应用的性能、可靠性、和可维护性，这些方面决定了用户体验和应用的长期可持续发展。首先，应用的性能是关键，要求启动和加载天气数据迅速，用户操作流畅无卡顿。此外，应用必须优化电量和数据流量的消耗，特别是在天气数据频繁更新和使用动画效果时，确保不对设备性能和电池续航产生负面影响。

应用的可靠性同样重要，必须保证天气数据的准确性和及时性，这是用户使用天气预报应用的核心需求之一。应用应该有良好的容错处理机制，当数据获取失败或网络连接中断时，能提供友好的错误提示，并尽可能提供离线状态下的天气信息缓存，以确保用户始终能获取基本的天气信息。

# 第四章 系统设计及实现

## 4.1 运行逻辑分析

程序启动后首先尝试读取首选项中存储的位置信息。读取成功则直接调用天气模块请求天气信息并更新UI。否则先调用定位模块，将获取的位置传递给天气模块，由天气模块完成相关工作。定位模块每次获取到定位信息之后都通过首选项存储在本地以实现位置信息的复用，减少资源消耗同时优化用户体验。程序运行流程如下图所示。

 



 

## 4.2 核心功能实现

### 4.2.1 定位模块

定位模块采用高德定位SDK，借助SDK实现了两个具体功能：自动定位和手动定位，将其全部封装到Locate类中以降低耦合度。具体实现如下：

自动定位：自动定位用到了AmapLocationClient，AmapLocationListener，AmapLocationClientOption三个类。AmapLocationClient是发起定位的类，AmapLocationListener是定位监听回调器，AmapLocationClientOption是定位选项。初始化AmapLocationClient后调用setLocationListener（）方法绑定回调器，调用setLocationOption（）生效定位选项。高德定位服务包含GPS和网络定位（Wi-Fi和基站定位）两种能力。定位SDK将GPS、网络定位能力进行了封装，以三种定位模式对外开放，SDK默认选择使用高精度定位模式。高精度模式会同时使用网络定位和GPS定位，优先返回最高精度的定位结果，定位选项调用setLocationMode(AMapLocationMode.Device_Sensors) 方法启用高精度定位。在回调器中重写onLocationChanged(AMapLocation amapLocation)方法以处理定位成功后的操作。重写代码如下：

 



 

手动定位：手动定位使用了SDK的POI搜索功能。高德提供了千万级别的 POI（Point of Interest，兴趣点）。在地图表达中，一个 POI 可代表一栋大厦、一家商铺、一处景点等等。通过POI搜索，完成找餐馆、找景点、找厕所等等的功能。地图 SDK 的搜索功能提供了多种获取 POI 数据的接口。使用该功能需要定义一个类继承PoiSearchV2.OnPoiSearchListener接口。用到的类主要是PoiSearchV2和PoiSearchV2.Query。前者是发起POI搜索的类，后者是设定搜索内容的类。 构造好 PoiSearchV2.Query对象后使用该对象初始化PoiSearchV2的对象。之后调用searchPOIAsyn()方法发起POI搜索。在类中重写onPoiSearched(PoiResult result, int rCode) 解析返回的结果。重写代码如下：

 

 

### 4.2.2 天气模块

天气模块的主要功能是请求彩云天气的API并解析返回结果以更新UI。请求API使用了Apache Commons IO 中的IOUtils.toString( URL url) 。该方法可以直接返回JSON字符串。解析JSON使用了Google Gson 库。主要使用Gson 里的JsonParser，JsonObject, JsonElement 三个类。JsonParser.parse(String str)方法可以将JSON字符串解析成一个 JsonELement 对象，之后调用 JsonElement 的 getAsJsonObject() 方法返回一个JsonObject对象。在JsonObject上调用各种方法获取所需数据。解析数据的存储使用了JDK的 HashMap<K，V> 数据结构，以键值对的方式存储天气数据，相关代码被封装到WeatherInfo类里，通过引用数据域的方式使用。如下图所示：

 

### 4.2.3 数据持久化功能

定位后及时的存储位置信息，避免不必要的定位对于提高页面响应速度，优化用户体验起着较为重要的作用。使用首选项，每次定位后都存储位置信息，以后程序每次启动都使用上次存储的位置信息请求天气。同时提供手动定位和重新定位按钮，给用户留出充足的选择空间。使程序的易用性得到质的提升。

# 第五章 开发日志

Day 1（6/21）

概要：初步认识API和JSON,为项目选择相应的API

详细：由于是初次接触API和JSON，所以首先通过查阅资料了解其概念及技术定位。API是一些预先定义的函数、协议和工具的集合，允许不同的软件程序之间进行通信和数据交换。JSON（JavaScript Object Notation）是一种数据交换格式，易于人类阅读和编写，同时也易于机器解析和生成。天气API选择了彩云天气API，原因是免费且功能强大，可实现最多3天的预报功能，并且较为稳定。

Day2 (6/23)

概要：学习使用Java解析Json，并实现了两个重要的后端功能：定位以及根据位置获取天气信息。详细：使用Google的第三方库Gson解析Json数据，原因是Gson更加易用。信息呈现方面，计划使用三个区块呈现信息：今天的天气（包括逐小时预报），未来三天的天气，生活指数。如图一。根据此目的分析彩云天气API返回值的结构 。并把解析Json的代码封装进 WeatherInfo 类里。定位方面，选择了高德地图API，通过官方教程添加依赖，根据其特点，封装了两个方法，分别实现自动定位和POI搜索定位。实际应用时，程序一直崩溃闪退，这极大的拖慢了开发进度，后来通过不断调试以及使用ChatGPT分析代码，发现问题是没有动态申请危险权限，上课讲过此类内容，实际开发时还是没有避开该类问题，实在汗颜。另外，在开发定位功能时，代码直接集成在主类里，后期为了使整体结构更加清晰，把相关代码封装到了单独的Locate类里，这并不简单，如果没有一定的Java基础，很难在一天之内完成。定位和通过位置获取天气这两个后台功能实现之后，下一步可以尝试开发UI界面了。

Day 3（6/24）概要：完成了部分UI设计
详细：细化了UI界面的组成，一共三部分，分别是：今天的天气，未来几天的天气和生活指数。整体采用线性布局，暂定三部分均分。今天的天气嵌套线性布局，顶部是位置信息，中间强调显示的当前温度，当前天气和今天的最高温度，最低温度。底部显示逐小时的温度及天气。成果如图二所示。定位操作和获取天气信息的操作较为耗时，放到线程里，拿到数据后用runOnUIThread()方法更新UI。刚开始经常会在非主线程更新UI控件造成程序崩溃，浪费了相当一部分时间。明天继续完善UI界面。

Day 4 (6/25)
概要：完成了UI界面的设计，串联了前后端使程序正常工作。
详细：可能使由于昨天积累了一定经验，今天的开发驾轻孰就，没有再遇到线程错乱，程序崩溃的问题，很快的完成了其余两部分的设计。之后进一步丰富了界面元素，逐小时预报的控件添加了对应的天气图标，图标来源于和风天气。之后为了避免页面太过单调，自定义了背景元素并引用。这部分上课未曾讲过，主要通过查阅相关资料学习应用。绑定前后端的操作大同小异，很快就能完成。项目开发基本上结束。

Day 5 (6/26)
概要：增加了数据持久化功能。撰写设计报告，进行收尾工作。
详细：如果每次打开应用都需要重新定位，一方面会造成资源浪费，因为用户地理位置通不会变化太大。另一方面会减慢页面响应速度，不利于增加用户体验。今天在昨天的基础上进一步增加了数据持久化功能，如右图所示。每次定位后都会通过首选项 (SharedPreferences) 存储定位数据，程序打开后首先读取本地存储信息，并使用本地信息请求天气，更新UI。这样的话，每次打开应用都会使用应用上一次关闭时的位置，实测发现页面响应速度显著提高。此外还增加了一个重新定位按钮以定位到重新定位到当前位置，到现在为止程序真正了具有一定的实用性。开发结束。

 



 

# 第六章： 总结与展望

**总结**

天气预报在现代生活中扮演着不可或缺的角色，它不仅影响个人日常活动的安排，也对商业决策和公共安全产生深远影响。本文介绍了一款基于安卓平台开发的天气预报应用程序，通过结合自动和手动定位功能，为用户提供准确、实时的天气信息。应用显示了当前温度、体感温度、湿度、空气质量、紫外线指数、感冒风险、能见度等多项详细指标，并且提供了未来数天的天气预报，帮助用户做出科学合理的生活和工作安排。在用户位置未确定时，应用还能智能地提供默认天气信息，以确保用户始终能获取相关信息。

应用功能与优势

自动定位与手动选择：应用启动时自动获取用户位置，如果自动定位失败，用户可以手动选择位置，保证了信息的准确性和用户体验的便利性。

详细天气信息：应用展示了多种天气指标，包括当前温度、体感温度、湿度、空气质量指数（AQI）、紫外线指数、感冒风险、能见度等，帮助用户全面了解当时和未来的天气情况。

未来几天天气预报：用户可以查看未来数天的天气预报，包括温度变化、天气状况和预计降水概率，有助于用户做出长期安排和计划。

用户定制化体验：应用根据用户的实际需求提供个性化的天气信息展示，例如提醒用户防晒、穿衣建议等，增强了应用的实用性和用户粘性。

数据存储与管理：通过存储用户的位置信息和偏好设置，应用能够智能地为用户提供定制化的天气服务，提升了用户体验。

**展望未来**

为了进一步提升应用的功能和用户体验，我将采取以下措施：

引入更多的天气数据和预测模型：除了基本的天气指标外，我计划引入更多的数据如风速、降水概率、雷暴预警等，提升天气预测的准确性和全面性。

优化用户界面和交互体验：我将持续优化应用的用户界面设计，提升用户的操作便利性和信息获取效率，确保在不同设备和屏幕尺寸上的良好适配。

智能推荐和个性化服务：通过与第三方服务的合作，我计划引入智能推荐功能，如天气变化对健康的影响、户外活动建议等，为用户提供更加个性化和实用的服务。

增强社会影响力和应用场景扩展：我将积极探索应用在更广泛社会场景中的应用，如应急管理、城市规划等领域，为公共安全和城市运营提供支持和决策依据。

持续技术创新与用户反馈优化：我将保持对新技术的敏锐感知，通过持续的技术创新和用户反馈的积极响应，不断提升应用的品质和功能，以满足用户日益增长的需求和期待。

通过以上的努力和持续的改进，我相信这款安卓天气预报应用将成为用户生活中不可或缺的重要工具，为用户提供可靠、实用的天气信息服务，促进社会生活的智能化和便捷化发展。
